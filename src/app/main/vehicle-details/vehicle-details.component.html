<div id="forms" class="page-layout simple fullwidth" fxLayout="column">
  <div class="content p-16">
	
    <div class="pt-16 pb-32" fxLayout="column" fxLayoutAlign="start" fxLayout.gt-md="row">
    	<form class="mat-card mat-elevation-z4 p-24 pb-32" #myForm="ngForm" ngNativeValidate (ngSubmit)="onSubmit(myForm)" fxLayout="column"
		fxLayoutAlign="start" fxFlex="1 0 auto">
		<div class="h2 mb-24">Fleet management</div>
			<mat-tab-group mat-stretch-tabs class="tab-group" [selectedIndex]="selectedIndex" (selectedTabChange)="changeTab($event)">
				<mat-tab label="Bus"></mat-tab>
				<mat-tab label="Lorry"></mat-tab>
				<mat-tab label="4 Wheeler"></mat-tab>
				<mat-tab label="2 Wheeler"></mat-tab>
			</mat-tab-group>
			<div class="h3 mb-8">Department</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Department</mat-label>
					<mat-select placeholder="Select Department" [(ngModel)]="department"
						name="department" required>
						<ng-container *ngFor="let department of departmentData">
							<mat-option [value]="department.id">
								{{department.department_name}}
							</mat-option>
						</ng-container>
					</mat-select>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8">Vehicle Details</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Vehicle Number</mat-label>
					<input matInput autocomplete="off" name="busNo"
						[(ngModel)]="busNo" placeholder="Vehicle Number" required>
					<mat-error>This field is required</mat-error>
					</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Chassis Number</mat-label>
					<input matInput autocomplete="off" name="chassisNo" [(ngModel)]="chassisNo" placeholder="Chassis Number" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Engine Number</mat-label>
					<input matInput autocomplete="off" name="engineNo" [(ngModel)]="engineNo" placeholder="Engine Number" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Company Name</mat-label>
					<input matInput autocomplete="off" name="companyName" [(ngModel)]="companyName" placeholder="Company Name" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Owner Name</mat-label>
					<input matInput autocomplete="off" name="ownerName" [(ngModel)]="ownerName" placeholder="Owner Name" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Vehicle Model</mat-label>
					<input matInput autocomplete="off" name="vehicleModelNo" [(ngModel)]="vehicleModelNo" placeholder="Vehicle Model" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Invoice Amount</mat-label>
					<input matInput autocomplete="off" name="invoiceAmount" [(ngModel)]="invoiceAmount" placeholder="Invoice Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Invoice Date</mat-label>
					<input matInput [matDatepicker]="picker1" (click)="picker1.open()" autocomplete="off" name="invoiceDate"
						[(ngModel)]="invoiceDate" placeholder="Invoice Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
					<mat-datepicker #picker1></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Permit Renewed Date</mat-label>
					<input matInput [matDatepicker]="picker9" (click)="picker9.open()" autocomplete="off" name="permitRenewDate"
						[(ngModel)]="permitRenewDate" placeholder="Permit Renewed Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker9"></mat-datepicker-toggle>
					<mat-datepicker #picker9></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>

			</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>FC Date</mat-label>
					<input matInput [matDatepicker]="picker3" (click)="picker3.open()" autocomplete="off" name="fcDate"
						[(ngModel)]="fcDate" placeholder="FC Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
					<mat-datepicker #picker3></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Tax Date</mat-label>
					<input matInput [matDatepicker]="picker4" name="taxDate" (click)="picker4.open()" autocomplete="off"
						[(ngModel)]="taxDate" placeholder="Tax Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker4"></mat-datepicker-toggle>
					<mat-datepicker #picker4></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Tax Amount</mat-label>
					<input type="number" matInput autocomplete="off" name="taxAmount" [(ngModel)]="taxAmount" placeholder="Tax Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8">Insurance Details</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Insurance Company Name</mat-label>
					<input matInput autocomplete="off" name="insCompanyName" [(ngModel)]="insCompanyName" placeholder="Insurance Company Name" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Insurance Amount</mat-label>
					<input matInput autocomplete="off" name="insAmount" [(ngModel)]="insAmount" placeholder="Insurance Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Insurance Date</mat-label>
					<input matInput [matDatepicker]="picker2" name="insuranceDate" (click)="picker2.open()" autocomplete="off"
					[(ngModel)]="insuranceDate" placeholder="Insurance Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
					<mat-datepicker #picker2></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8">Loan Details</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Loan Amount</mat-label>
					<input matInput autocomplete="off" type="number" name="loanAmount" [(ngModel)]="loanAmount" placeholder="loan Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Loan A/C Number</mat-label>
					<input matInput autocomplete="off" name="loanAccNumber" [(ngModel)]="loanAccNumber" placeholder="A/c Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Loan Bank Name</mat-label>
					<input matInput autocomplete="off" name="loanBankName" [(ngModel)]="loanBankName" placeholder="Bank Name"
						required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Loan Due Amount</mat-label>
					<input matInput autocomplete="off" type="number" name="loanDueAmount" [(ngModel)]="loanDueAmount" placeholder="loan Due Amount"
						required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Due Date</mat-label>
					<input matInput [matDatepicker]="picker6" name="loanDueDate" (click)="picker6.open()" autocomplete="off"
						[(ngModel)]="loanDueDate" placeholder="Due Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker6"></mat-datepicker-toggle>
					<mat-datepicker #picker6></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">	
					<mat-label>End Date</mat-label>
					<input matInput [matDatepicker]="picker5" name="loanEndDate" (click)="picker5.open()" autocomplete="off"
						[(ngModel)]="loanEndDate" placeholder="End Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker5"></mat-datepicker-toggle>
					<mat-datepicker #picker5></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8" *ngIf="selectedIndex == 0 || selectedIndex == 1">Permit Details</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto" *ngIf="selectedIndex == 0 || selectedIndex == 1">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Permit Amount</mat-label>
					<input matInput type="number" autocomplete="off" name="permitAmount" [(ngModel)]="permitAmount"
						placeholder="Permit Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Start Date</mat-label>
					<input matInput [matDatepicker]="picker7" name="permitStartDate" (click)="picker7.open()" autocomplete="off"
						[(ngModel)]="permitStartDate" placeholder="Start Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker7"></mat-datepicker-toggle>
					<mat-datepicker #picker7></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>End Date</mat-label>
					<input matInput [matDatepicker]="picker8" name="permitEndDate" (click)="picker8.open()" autocomplete="off"
						[(ngModel)]="permitEndDate" placeholder="End Date" required>
					<mat-datepicker-toggle matSuffix [for]="picker8"></mat-datepicker-toggle>
					<mat-datepicker #picker8></mat-datepicker>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8" *ngIf="selectedIndex == 0">Route Details</div>
			<div fxLayout="row" *ngIf="selectedIndex == 0" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Route Details</mat-label>
					<mat-select [(ngModel)]="routeDetails" name="routeDetails" required (ngModelChange)="selectRoute()">
						<ng-container *ngFor="let data of routeData">
							<mat-option [value]="data.id">
								{{data.source+" - "+data.destination}}
							</mat-option>
						</ng-container>
					</mat-select>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="25" appearance="outline">
					<mat-label>Number of Trips</mat-label>
					<input matInput autocomplete="off" name="noTrips" [(ngModel)]="noTrips" (ngModelChange)="calculateTrip()" placeholder="Number of Trips" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="25" appearance="outline">
					<mat-label>Number of Stages</mat-label>
					<input matInput autocomplete="off" name="noStages" [(ngModel)]="noStages" placeholder="Number of Stages" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>

			</div>
			<div *ngIf="noTrips" style="width: 100%;" fxLayout="column">
				<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
					<div fxFlex="5">
						
					</div>
					<div fxFlex="20" fxLayoutAlign="start center">
						From
					</div>
					<div fxFlex="20" fxLayoutAlign="start center">
						To
					</div>
					<div fxFlex="20" fxLayoutAlign="start center">
						Start Time
					</div>
					<div fxFlex="20" fxLayoutAlign="start center">
						End Time
					</div>
				</div>
				<ng-container *ngFor="let data of tripData;let i=index;let indexIden=index;">
					<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
						<div fxFlex="5">
							{{"Trip "+(i+1)}}
						</div>
						<div fxFlex="20">
							<mat-form-field fxFlex="100" appearance="outline">
								<mat-label>From</mat-label>
								<input type="text" matInput autocomplete="off" name='{{"from"+i}}' [(ngModel)]="data['from']"
									placeholder="From" required>
								<mat-error>required</mat-error>
							</mat-form-field>
						</div>
						<div fxFlex="20">
							<mat-form-field fxFlex="100" appearance="outline">
								<mat-label>To</mat-label>
								<input type="text" matInput autocomplete="off" name='{{"to"+i}}' [(ngModel)]="data['to']"
									placeholder="To" required>
								<mat-error>required</mat-error>
							</mat-form-field>
						</div>
						<div fxFlex="20">
							<mat-form-field fxFlex="100" appearance="outline">
								<mat-label>Start Time</mat-label>
								<input type="time" matInput autocomplete="off"
									name='{{"startTime"+i}}' [(ngModel)]="data['startTime']" placeholder="Start Time" required>
								<mat-error>required</mat-error>
							</mat-form-field>
						</div>
						<div fxFlex="20">
							<mat-form-field fxFlex="100" appearance="outline">
								<mat-label>End Time</mat-label>
								<input type="time" matInput autocomplete="off"
									name='{{"endTime"+i}}' [(ngModel)]="data['endTime']" placeholder="End Time">
							</mat-form-field>
						</div>
					</div>
				</ng-container>
			</div>
			<div class="h3 mb-8" *ngIf="selectedIndex == 0">Employee Details</div>
			<div fxLayout="row" *ngIf="selectedIndex == 0" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Driver Name</mat-label>
					<mat-select [(ngModel)]="driverName" name="driverName" required>
						<ng-container *ngFor="let data of driverData">
							<mat-option [value]="data.auto_inc_id">
								{{data.employee_name}}
							</mat-option>
						</ng-container>
					</mat-select>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Conductor Name</mat-label>
					<mat-select [(ngModel)]="conductorName" name="conductorName" required>
						<ng-container *ngFor="let data of conductorData">
							<mat-option [value]="data.auto_inc_id">
								{{data.employee_name}}
							</mat-option>
						</ng-container>
					</mat-select>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Trainee Name</mat-label>
					<mat-select [(ngModel)]="traineeName" name="traineeName">
						<ng-container *ngFor="let data of traineeData">
							<mat-option [value]="data.auto_inc_id">
								{{data.employee_name}}
							</mat-option>
						</ng-container>
					</mat-select>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8" *ngIf="selectedIndex == 0">Beta Details</div>
			<div fxLayout="row" *ngIf="selectedIndex == 0" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="25" appearance="outline">
					<mat-label>Driver Beta Percentage</mat-label>
					<input matInput autocomplete="off" max="100" name="driverBetaPercent" [(ngModel)]="driverBetaPercent" placeholder="Driver Beta Percentage" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="25" appearance="outline">
					<mat-label>Conductor Beta Percentage</mat-label>
					<input matInput autocomplete="off" max="100" name="conductorBetaPercent" [(ngModel)]="conductorBetaPercent" placeholder="Conductor Beta Percentage" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div class="h3 mb-8" *ngIf="selectedIndex == 0">Special Beta Details</div>
			<div fxLayout="row" *ngIf="selectedIndex == 0" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Starting Amount</mat-label>
					<input matInput autocomplete="off" max="100" name="startAmountOne" [(ngModel)]="startAmountOne" placeholder="Starting Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>End Amount</mat-label>
					<input matInput autocomplete="off" max="100" min={{startAmountOne+1}} name="endAmountOne" [(ngModel)]="endAmountOne" placeholder="End Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Beta Amount</mat-label>
					<input matInput autocomplete="off" max="100"  name="betaAmountOne" [(ngModel)]="betaAmountOne" placeholder=" Beta Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div fxLayout="row" *ngIf="selectedIndex == 0" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Starting Amount</mat-label>
					<input matInput autocomplete="off" max="100" name="startAmountTwo" [(ngModel)]="startAmountTwo" placeholder="Starting Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>End Amount</mat-label>
					<input matInput autocomplete="off" max="100" min={{startAmountTwo+1}} name="endAmountTwo" [(ngModel)]="endAmountTwo" placeholder="End Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
				<mat-form-field fxFlex="33" appearance="outline">
					<mat-label>Beta Amount</mat-label>
					<input matInput autocomplete="off" max="100" name="betaAmountTwo" [(ngModel)]="betaAmountTwo" placeholder=" Beta Amount" required>
					<mat-error>This field is required</mat-error>
				</mat-form-field>
			</div>
			<div fxLayout="row" fxLayoutAlign="start center" fxFlex="1 0 auto">
				<div style="width: 50%;">
					<mat-label>Image</mat-label>
					<input #imageInput type="file" autocomplete="off" placeholder="Image" accept="image/*"
						(change)="uploadedFile($event)" required="{{!imageUrl	?true :null}}">
				</div>
				<div style="width: 50%;">
					<img *ngIf="imageUrl" class="image-preview" [src]="imageUrl">
				</div>
			</div>
			<div align="center">
				<button mat-raised-button color="accent" class="submit-button" aria-label="Submit">{{submitBtnText}}</button>
			</div>
    	</form>
	</div>
		<div class="mat-elevation-z8 fuse-card auto-width p-8" fxLayout="column" fxLayoutAlign="center center"
			fxLayout.gt-xs="row" fxLayoutAlign.gt-xs="flex-end center">
			<mat-form-field appearance="outline" class="noPaddingBottom">
				<input matInput (keyup)="applyFilter($event.target.value)" autocomplete="off" placeholder="Vehicle No, Owner Name, Model  ">
			</mat-form-field>
		</div>
		<div class="pt-16 pb-32" fxLayout="column" fxLayoutAlign="start" fxLayout.gt-md="row">
			<table mat-table [dataSource]="dataSource">
		
				<ng-container matColumnDef="sno">
					<th mat-header-cell *matHeaderCellDef>S.No. </th>
					<td mat-cell *matCellDef="let row;let i=index;"> {{ i + 1 }} </td>
				</ng-container>
		
				<ng-container matColumnDef="bus_no">
					<th mat-header-cell *matHeaderCellDef>Vehicle Number </th>
					<td mat-cell *matCellDef="let row"> {{row.bus_no}} </td>
				</ng-container>
		
				<ng-container matColumnDef="owner_name">
					<th mat-header-cell *matHeaderCellDef>Owner Name </th>
					<td mat-cell *matCellDef="let row"> {{row.owner_name}} </td>
				</ng-container>
		
				<ng-container matColumnDef="vehicle_model_no">
					<th mat-header-cell *matHeaderCellDef>Vehicle Model</th>
					<td mat-cell *matCellDef="let row"> {{row.vehicle_model_no}} </td>
				</ng-container>

				<ng-container matColumnDef="insurance_amount">
					<th mat-header-cell *matHeaderCellDef>Insurance Amount</th>
					<td mat-cell *matCellDef="let row"> {{row.insurance_amount}} </td>
				</ng-container>
		
				<ng-container matColumnDef="action">
					<th mat-header-cell *matHeaderCellDef> Action </th>
					<td mat-cell *matCellDef="let row">
						<div style="display: flex;justify-content: center;">
							<button type="button" mat-icon-button color="accent" title="Edit" (click)="edit(row)">
								<mat-icon>edit</mat-icon>
							</button>
							<button mat-icon-button type="button" class="actionBtn" color="accent" title="Delete"
								(click)="delete(row)">
								<mat-icon>delete</mat-icon>
							</button>
						</div>
					</td>
				</ng-container>
		
				<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
				<tr mat-row *matRowDef="let row; columns: displayedColumns;">
				</tr>
			</table>
		</div>
		<mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
	</div>
</div>